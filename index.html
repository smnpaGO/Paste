<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Full Web HTML Tester — Minimal</title>
<style>
  :root{
    --bg:#0f1113;
    --panel:#0b0c0d;
    --muted:#9aa1a6;
    --accent:#ff3b6b;
    --editor-width:420px; /* ubah lebar editor di sini */
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{background:var(--bg);color:#e6eef3;display:flex;flex-direction:column}
  /* top bar */
  .topbar{
    height:46px; background:#0a0b0c; display:flex;align-items:center;gap:8px;padding:0 12px;border-bottom:1px solid rgba(255,255,255,0.03);
  }
  .brand{font-weight:600;color:#dfe7eb;margin-right:8px}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
  .btn{
    background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 10px;border-radius:6px;color:var(--muted);cursor:pointer;font-size:13px;
  }
  .btn.primary{background:linear-gradient(90deg,#7b61ff,#c05bff);border:none;color:white}
  .btn.warn{background:transparent;border:1px solid rgba(255,90,90,0.12);color:#ff9aa2}
  /* layout */
  .workspace{flex:1;display:flex;min-height:0} /* min-height:0 for flexbox children scrolling */
  .editor-pane{
    width:var(--editor-width);
    min-width:160px;
    max-width:70%;
    background:linear-gradient(180deg,#090909,#0f1113);
    border-right:1px solid rgba(255,255,255,0.03);
    display:flex;flex-direction:column;
  }
  .file-tabs{height:36px;display:flex;gap:6px;align-items:center;padding:6px}
  .tab{padding:6px 10px;border-radius:6px;font-size:13px;color:var(--muted);cursor:pointer;border:1px solid transparent}
  .tab.active{background:#121314;color:#fff;border:1px solid rgba(255,255,255,0.03)}
  .editor{flex:1;display:flex;overflow:auto;padding:10px}
  textarea.code{
    width:100%;height:100%;resize:none;background:transparent;border:none;outline:none;color:#e6eef3;
    font-family:ui-monospace,SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;font-size:14px;line-height:1.5;
  }
  .preview-pane{flex:1;display:flex;flex-direction:column;min-width:200px}
  .preview-top{height:36px;display:flex;align-items:center;padding:0 10px;color:var(--muted);border-bottom:1px solid rgba(255,255,255,0.02)}
  .preview-frame{flex:1;background:#fff;min-height:0} /* for iframe to scroll */
  iframe#preview{width:100%;height:100%;border:0;background:white}
  /* small helper */
  .hint{font-size:12px;color:var(--muted);margin-left:8px}
  /* responsive for small screens: make editor narrower and stack if too narrow */
  @media (max-width:720px){
    :root{--editor-width:300px}
  }
  @media (max-width:480px){
    .workspace{flex-direction:column}
    .editor-pane{width:100%;height:45vh;max-width:none}
    .preview-pane{height:55vh}
  }
</style>
</head>
<body>
  <div class="topbar">
    <div class="brand">Tester — HTML Full</div>
    <div class="controls">
      <button class="btn" id="runPreview">Run Preview</button>
      <button class="btn primary" id="runFull">Run Full Page</button>
      <button class="btn warn" id="resetBtn">Reset</button>
    </div>
  </div>

  <div class="workspace">
    <div class="editor-pane" role="region" aria-label="Editor">
      <div class="file-tabs">
        <div class="tab active" data-tab="html">index.html</div>
        <div class="tab" data-tab="css">styles.css</div>
        <div class="tab" data-tab="js">script.js</div>
        <div class="hint" id="autosaveHint">Auto-saved</div>
      </div>

      <div class="editor">
        <textarea id="editor" class="code" spellcheck="false" aria-label="Code editor"></textarea>
      </div>
    </div>

    <div class="preview-pane" role="region" aria-label="Preview">
      <div class="preview-top">Preview (iframe) <span class="hint" id="previewInfo"></span></div>
      <div class="preview-frame">
        <iframe id="preview" sandbox="allow-scripts allow-forms allow-modals"></iframe>
      </div>
    </div>
  </div>

<script>
(() => {
  // Initial template
  const defaultHTML = `<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Preview</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1 style="color:#7b61ff;font-family:system-ui;">Hello from Preview</h1>
  <p>Edit the HTML / CSS / JS tabs and press Run Preview or Run Full Page.</p>
  <script src="script.js"></script>
</body>
</html>`;

  const defaultCSS = `body{font-family:system-ui;background:#fafafa;padding:20px}
h1{margin:0 0 8px}`;
  const defaultJS = `console.log('preview ready');`;

  // tabs storage
  const storageKey = 'mini_fulltester_v1';
  let state = JSON.parse(localStorage.getItem(storageKey) || '{}');
  if(!state.html) state.html = defaultHTML;
  if(!state.css) state.css = defaultCSS;
  if(!state.js) state.js = defaultJS;

  const editor = document.getElementById('editor');
  const tabs = Array.from(document.querySelectorAll('.tab'));
  let currentTab = 'html';

  function setTab(tab){
    currentTab = tab;
    tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
    if(tab === 'html') editor.value = state.html;
    if(tab === 'css') editor.value = state.css;
    if(tab === 'js') editor.value = state.js;
    editor.focus();
  }
  tabs.forEach(t => t.addEventListener('click', ()=> setTab(t.dataset.tab)));
  setTab('html');

  // autosave
  let saveTimer = null;
  editor.addEventListener('input', ()=>{
    if(currentTab === 'html') state.html = editor.value;
    if(currentTab === 'css') state.css = editor.value;
    if(currentTab === 'js') state.js = editor.value;
    clearTimeout(saveTimer);
    saveTimer = setTimeout(()=> {
      localStorage.setItem(storageKey, JSON.stringify(state));
      document.getElementById('autosaveHint').textContent = 'Auto-saved';
    }, 600);
    document.getElementById('autosaveHint').textContent = 'Editing...';
  });

  // build preview content (inject CSS & JS into HTML using blob URLs)
  function buildPreviewHTML(){
    // If html already includes separate links for styles/script, we will replace them with blob URLs
    const cssBlob = new Blob([state.css], {type:'text/css'});
    const jsBlob = new Blob([state.js], {type:'text/javascript'});
    const cssUrl = URL.createObjectURL(cssBlob);
    const jsUrl = URL.createObjectURL(jsBlob);

    // If HTML has link rel=stylesheet or script src=, keep but also try to update simple placeholders.
    let html = state.html;

    // Simple heuristic: replace <link rel="stylesheet" href="styles.css"> with blob
    html = html.replace(/<link[^>]*href=["']styles\.css["'][^>]*>/i, `<link rel="stylesheet" href="${cssUrl}">`);
    // Replace <script src="script.js"></script>
    html = html.replace(/<script[^>]*src=["']script\.js["'][^>]*>\s*<\/script>/i, `<script src="${jsUrl}"></script>`);
    // If the HTML didn't reference them, inject into head/body
    if(!/styles\.css/i.test(state.html)){
      html = html.replace(/<head([^>]*)>/i, `<head$1>\n<link rel="stylesheet" href="${cssUrl}">`);
    }
    if(!/script\.js/i.test(state.html)){
      // inject before </body>
      html = html.replace(/<\/body>/i, `<script src="${jsUrl}"></script>\n</body>`);
    }
    return html;
  }

  // preview iframe
  const iframe = document.getElementById('preview');
  document.getElementById('runPreview').addEventListener('click', () => {
    // update state from editor one last time
    if(currentTab === 'html') state.html = editor.value;
    if(currentTab === 'css') state.css = editor.value;
    if(currentTab === 'js') state.js = editor.value;
    localStorage.setItem(storageKey, JSON.stringify(state));

    const html = buildPreviewHTML();
    iframe.srcdoc = html;
    document.getElementById('previewInfo').textContent = ' • updated';
    setTimeout(()=> document.getElementById('previewInfo').textContent = '', 1400);
  });

  // run full page (replace entire document)
  document.getElementById('runFull').addEventListener('click', () => {
    if(currentTab === 'html') state.html = editor.value;
    if(currentTab === 'css') state.css = editor.value;
    if(currentTab === 'js') state.js = editor.value;
    localStorage.setItem(storageKey, JSON.stringify(state));

    // We will attempt to create a single HTML that inlines CSS and JS if user wants full page.
    // Build a combined HTML:
    // If the HTML content already includes <head> and <body>, inject css/js into it; otherwise wrap.
    let final = state.html;
    const styleTag = `<style>\n${state.css}\n</style>`;
    const scriptTag = `<script>\n${state.js}\n<\/script>`;

    if(/<head[\s\S]*?>/i.test(final)){
      final = final.replace(/<head([^>]*)>/i, `<head$1>\n${styleTag}`);
    } else {
      final = final.replace(/<html([^>]*)>/i, `<html$1>\n<head>\n${styleTag}\n</head>`);
    }
    if(/<\/body>/i.test(final)){
      final = final.replace(/<\/body>/i, `${scriptTag}\n</body>`);
    } else {
      final = final + `\n<body>\n${scriptTag}\n</body>`;
    }

    // replace entire document
    document.open();
    document.write(final);
    document.close();
    // Note: after this, the editor page is gone — use Reset to restore (we saved initial snapshot below)
  });

  // store initial snapshot of page so Reset works even after runFull
  const initialSnapshot = document.documentElement.outerHTML;

  // reset
  document.getElementById('resetBtn').addEventListener('click', () => {
    // clear stored code if you want blank: localStorage.removeItem(storageKey);
    // but here we restore page structure (works after runFull)
    // If we're still in the editor context just reload from saved template.
    try {
      // If current page was replaced, reload saved editor HTML by writing initialSnapshot
      document.open();
      document.write(initialSnapshot);
      document.close();
      // After restoring, we need to reload script to reinitialize — easiest: force reload
      location.reload();
    } catch(e){
      location.reload();
    }
  });

  // expose small API for resizing width (if user wants tiny/narrow)
  window.setEditorWidth = (px) => {
    document.documentElement.style.setProperty('--editor-width', px + 'px');
  };

  // initialize preview with saved content
  iframe.srcdoc = buildPreviewHTML();

  // make sure editor shows current tab content
  setTab(currentTab);
})();
</script>
</body>
</html>